<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Á∑®ËºØÂô®Ê∏¨Ë©¶ - Âç≥ÊôÇÈ†êË¶ΩÁâà</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Markdown Áõ∏ÈóúÂ∫´ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <style>
        .preview-content {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
        }
        
        .preview-content h1,
        .preview-content h2,
        .preview-content h3 {
            font-weight: 700;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }
        
        .preview-content h1 { font-size: 2em; }
        .preview-content h2 { font-size: 1.5em; }
        .preview-content h3 { font-size: 1.25em; }
        
        .preview-content p {
            margin-bottom: 1em;
        }
        
        .preview-content code {
            background: #f6f8fa;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-size: 0.9em;
        }
        
        .preview-content pre {
            background: #f6f8fa;
            padding: 1em;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1em 0;
        }
        
        .preview-content pre code {
            background: none;
            padding: 0;
        }
        
        .preview-content a {
            color: #0969da;
            text-decoration: none;
        }
        
        .preview-content a:hover {
            text-decoration: underline;
        }
        
        .preview-content blockquote {
            border-left: 4px solid #d0d7de;
            padding-left: 1em;
            margin: 1em 0;
            color: #57606a;
        }
        
        .toast {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 1rem 1.5rem;
            z-index: 10000;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .drag-over {
            background-color: #eff6ff !important;
            border: 2px dashed #3b82f6 !important;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <div class="mb-6">
            <h1 class="text-3xl font-bold text-gray-900">Markdown Á∑®ËºØÂô®Ê∏¨Ë©¶</h1>
            <p class="text-gray-600 mt-2">Âç≥ÊôÇÈ†êË¶ΩÁâà - È†êË¶ΩÂçÄÂüüÈ†êË®≠È°ØÁ§∫Ôºå‰∏çÂèØÈóúÈñâ</p>
        </div>

        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <!-- Â∑•ÂÖ∑Âàó -->
            <div class="bg-gray-50 border-b border-gray-200 p-3 flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <button type="button" onclick="insertMarkdown('**', '**', 'Á≤óÈ´îÊñáÂ≠ó')" 
                            class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded text-sm font-bold" 
                            title="Á≤óÈ´î (Ctrl+B)">
                        B
                    </button>
                    <button type="button" onclick="insertMarkdown('*', '*', 'ÊñúÈ´îÊñáÂ≠ó')" 
                            class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded text-sm italic" 
                            title="ÊñúÈ´î (Ctrl+I)">
                        I
                    </button>
                    <button type="button" onclick="insertMarkdown('`', '`', 'Á®ãÂºèÁ¢º')" 
                            class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded text-sm font-mono" 
                            title="Ë°åÂÖßÁ®ãÂºèÁ¢º">
                        &lt;/&gt;
                    </button>
                    <button type="button" onclick="insertLink()" 
                            class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded text-sm" 
                            title="ÊèíÂÖ•ÈÄ£Áµê (Ctrl+K)">
                        üîó
                    </button>
                    <button type="button" onclick="insertHeading()" 
                            class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded text-sm font-bold" 
                            title="ÊèíÂÖ•Ê®ôÈ°å">
                        H
                    </button>
                </div>

                <div class="flex items-center space-x-3">
                    <div class="text-sm text-gray-500">
                        <span id="charCount">0</span> Â≠ó
                    </div>
                </div>
            </div>

            <!-- Á∑®ËºØÂçÄÂüü -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-0">
                <!-- ÊñáÂ≠óËº∏ÂÖ•ÂçÄ -->
                <div class="p-4 border-r border-gray-200" id="editorPane">
                    <textarea 
                        id="content" 
                        class="w-full h-[600px] p-4 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono"
                        placeholder="Âú®Ê≠§Ëº∏ÂÖ• Markdown Ê†ºÂºèÁöÑÊñáÁ´†ÂÖßÂÆπ..."
                    ># Ê≠°Ëøé‰ΩøÁî® Markdown Á∑®ËºØÂô®

ÈÄôÊòØ‰∏ÄÂÄãÊ∏¨Ë©¶Êñá‰ª∂ÔºåÁî®‰æÜÂ±ïÁ§∫**Âç≥ÊôÇÈ†êË¶Ω**ÂäüËÉΩ„ÄÇ

## ÂäüËÉΩÁâπËâ≤

1. **Âç≥ÊôÇÈ†êË¶Ω** - È†êË¶ΩÂçÄÂüüÈ†êË®≠È°ØÁ§∫
2. **Ë™ûÊ≥ïÈ´ò‰∫Æ** - ÊîØÊè¥Á®ãÂºèÁ¢ºÈ´ò‰∫Æ
3. **Ëá™ÂãïÂÑ≤Â≠ò** - ÊØè 3 ÁßíËá™ÂãïÂÑ≤Â≠òËçâÁ®ø
4. **ÊãñÊãΩ‰∏äÂÇ≥** - ÊîØÊè¥ÂúñÁâáÊãñÊãΩ‰∏äÂÇ≥

## Á®ãÂºèÁ¢ºÁØÑ‰æã

```python
def hello_world():
    print("Hello, World!")
```

## ÂºïÁî®

> ÈÄôÊòØ‰∏ÄÊÆµÂºïÁî®ÊñáÂ≠ó

## ÈÄ£Áµê

[GitHub](https://github.com)</textarea>
                </div>

                <!-- È†êË¶ΩÂçÄ -->
                <div id="previewPane" class="p-4 bg-gray-50">
                    <div id="previewContent" class="preview-content h-[600px] overflow-y-auto p-4">
                        <div class="text-center py-12 text-gray-400">
                            <svg class="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            <p class="text-lg">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    // ÂÖ®ÂüüËÆäÊï∏
    let autoSaveTimer = null;
    let contentTextarea = null;
    let previewContent = null;

    // ÂàùÂßãÂåñ
    document.addEventListener('DOMContentLoaded', function() {
        contentTextarea = document.getElementById('content');
        previewContent = document.getElementById('previewContent');
        
        if (!contentTextarea) {
            console.error('Êâæ‰∏çÂà∞Á∑®ËºØÂô®ÂÖÉÁ¥†');
            return;
        }

        // Á≠âÂæÖ CDN ËºâÂÖ•
        waitForCDN().then(() => {
            console.log('CDN Â∫´Â∑≤ËºâÂÖ•');
            
            // Á∂ÅÂÆöËº∏ÂÖ•‰∫ã‰ª∂ - Âç≥ÊôÇÊõ¥Êñ∞È†êË¶Ω
            contentTextarea.addEventListener('input', function() {
                updateCharCount();
                updatePreview();
                scheduleAutoSave();
            });

            // Á∂ÅÂÆöÂø´Êç∑Èçµ
            contentTextarea.addEventListener('keydown', handleKeyboardShortcuts);

            // ÊãñÊãΩ‰∏äÂÇ≥
            initializeDragDrop();

            // ÂàùÂßãÂ≠óÊï∏Áµ±Ë®à
            updateCharCount();

            // ÂàùÂßãÂåñÈ†êË¶Ω
            updatePreview();
            
            showToast('Á∑®ËºØÂô®Â∑≤Â∞±Á∑í [OK]', 'success');
        });
    });

    // Á≠âÂæÖ CDN Â∫´ËºâÂÖ•
    function waitForCDN() {
        return new Promise((resolve) => {
            let attempts = 0;
            const maxAttempts = 10;
            
            const checkCDN = () => {
                if (typeof marked !== 'undefined' && typeof DOMPurify !== 'undefined') {
                    // ÈÖçÁΩÆ marked
                    if (marked.setOptions) {
                        marked.setOptions({
                            breaks: true,
                            gfm: true,
                            headerIds: true,
                            mangle: false,
                            sanitize: false,
                            smartLists: true,
                            smartypants: false
                        });
                    }
                    resolve(true);
                } else {
                    attempts++;
                    if (attempts < maxAttempts) {
                        setTimeout(checkCDN, 200);
                    } else {
                        console.error('CDN ËºâÂÖ•Â§±Êïó');
                        showToast('Markdown Ëß£ÊûêÂô®ËºâÂÖ•Â§±Êïó', 'error');
                        resolve(false);
                    }
                }
            };
            
            checkCDN();
        });
    }

    // Êõ¥Êñ∞È†êË¶Ω
    function updatePreview() {
        if (!previewContent || typeof marked === 'undefined' || typeof DOMPurify === 'undefined') {
            return;
        }

        const content = contentTextarea.value.trim();

        if (!content) {
            previewContent.innerHTML = `
                <div class="text-center py-12 text-gray-400">
                    <svg class="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    <p class="text-lg">ÈñãÂßãËº∏ÂÖ•‰ª•Êü•ÁúãÈ†êË¶Ω</p>
                </div>
            `;
            return;
        }

        try {
            // Ëß£Êûê Markdown
            const rawHtml = marked.parse(content);
            
            // Ê∏ÖÁêÜ HTML
            const cleanHtml = DOMPurify.sanitize(rawHtml, {
                ALLOWED_TAGS: [
                    'p', 'br', 'strong', 'em', 'u', 'del', 'mark',
                    'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
                    'ul', 'ol', 'li', 'dl', 'dt', 'dd',
                    'blockquote', 'pre', 'code',
                    'a', 'img',
                    'table', 'thead', 'tbody', 'tfoot', 'tr', 'th', 'td',
                    'div', 'span', 'hr'
                ],
                ALLOWED_ATTR: ['href', 'src', 'alt', 'title', 'class', 'id'],
                KEEP_CONTENT: true
            });

            previewContent.innerHTML = cleanHtml;

            // È´ò‰∫ÆÁ®ãÂºèÁ¢º
            if (typeof hljs !== 'undefined') {
                previewContent.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });
            }

            // Â§ñÈÉ®ÈÄ£ÁµêË®≠ÂÆö
            previewContent.querySelectorAll('a').forEach((link) => {
                if (link.hostname !== window.location.hostname) {
                    link.target = '_blank';
                    link.rel = 'noopener noreferrer';
                }
            });

        } catch (error) {
            console.error('È†êË¶ΩÊõ¥Êñ∞ÈåØË™§:', error);
            previewContent.innerHTML = `
                <div class="text-center py-12 text-red-500">
                    <p class="text-lg font-medium">È†êË¶ΩËß£ÊûêÈåØË™§</p>
                    <p class="text-sm mt-2">${error.message}</p>
                </div>
            `;
        }
    }

    // Êõ¥Êñ∞Â≠óÊï∏Áµ±Ë®à
    function updateCharCount() {
        const charCount = document.getElementById('charCount');
        if (charCount && contentTextarea) {
            const count = contentTextarea.value.length;
            charCount.textContent = count.toLocaleString();
        }
    }

    // ÊèíÂÖ• Markdown Ê®ôË®ò
    function insertMarkdown(before, after, placeholder) {
        const start = contentTextarea.selectionStart;
        const end = contentTextarea.selectionEnd;
        const selectedText = contentTextarea.value.substring(start, end);
        const textToInsert = selectedText || placeholder;
        const newText = before + textToInsert + after;
        
        contentTextarea.setRangeText(newText, start, end, 'end');
        contentTextarea.focus();
        
        if (!selectedText) {
            contentTextarea.setSelectionRange(start + before.length, start + before.length + placeholder.length);
        }
        
        contentTextarea.dispatchEvent(new Event('input'));
    }

    // ÊèíÂÖ•ÈÄ£Áµê
    function insertLink() {
        const url = prompt('Ë´ãËº∏ÂÖ•ÈÄ£ÁµêÁ∂≤ÂùÄÔºö');
        if (url) {
            const text = prompt('Ë´ãËº∏ÂÖ•ÈÄ£ÁµêÊñáÂ≠óÔºö') || url;
            insertMarkdown('[', `](${url})`, text);
        }
    }

    // ÊèíÂÖ•Ê®ôÈ°å
    function insertHeading() {
        insertMarkdown('## ', '', 'Ê®ôÈ°åÊñáÂ≠ó');
    }

    // ÈçµÁõ§Âø´Êç∑Èçµ
    function handleKeyboardShortcuts(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
            e.preventDefault();
            insertMarkdown('**', '**', 'Á≤óÈ´îÊñáÂ≠ó');
        }
        
        if ((e.ctrlKey || e.metaKey) && e.key === 'i') {
            e.preventDefault();
            insertMarkdown('*', '*', 'ÊñúÈ´îÊñáÂ≠ó');
        }
        
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            insertLink();
        }
    }

    // ÊãñÊãΩ‰∏äÂÇ≥
    function initializeDragDrop() {
        const editorPane = document.getElementById('editorPane');
        
        editorPane.addEventListener('dragover', function(e) {
            e.preventDefault();
            e.stopPropagation();
            editorPane.classList.add('drag-over');
        });

        editorPane.addEventListener('dragleave', function(e) {
            e.preventDefault();
            e.stopPropagation();
            editorPane.classList.remove('drag-over');
        });

        editorPane.addEventListener('drop', function(e) {
            e.preventDefault();
            e.stopPropagation();
            editorPane.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.type.startsWith('image/')) {
                    showToast('ÊãñÊãΩ‰∏äÂÇ≥ÂäüËÉΩÈúÄË¶ÅÂæåÁ´ØÊîØÊè¥', 'info');
                }
            }
        });
    }

    // Ëá™ÂãïÂÑ≤Â≠ò
    function scheduleAutoSave() {
        if (autoSaveTimer) {
            clearTimeout(autoSaveTimer);
        }
        
        autoSaveTimer = setTimeout(() => {
            const content = contentTextarea.value;
            localStorage.setItem('draft_content', content);
            localStorage.setItem('draft_time', Date.now());
            console.log('ËçâÁ®øÂ∑≤Ëá™ÂãïÂÑ≤Â≠ò');
        }, 3000);
    }

    // Toast ÈÄöÁü•
    function showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = 'toast';
        
        const colors = {
            success: 'bg-green-50 text-green-800 border-green-200',
            error: 'bg-red-50 text-red-800 border-red-200',
            info: 'bg-blue-50 text-blue-800 border-blue-200'
        };
        
        toast.className += ' border ' + (colors[type] || colors.info);
        toast.textContent = message;
        
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }
    </script>
</body>
</html>
